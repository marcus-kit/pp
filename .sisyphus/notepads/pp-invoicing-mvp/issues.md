## Находки QA (Задача 14)

### Критические проблемы
1. **Redirect Loop на живом сайте**: `https://pp.doka.team` редиректит на себя (`/` -> `/`). Это препятствует E2E тестированию на живом окружении. Вероятно, проблема конфигурации Traefik/Cloudflare или обработки trailing slash в Nuxt.
2. **Уязвимость безопасности RLS**: Политика "Anon can view invoice by public token" была слишком разрешительной (`USING (true)`), позволяя анонимным пользователям потенциально получить список всех счетов.
   - **Исправление**: Политика удалена. Публичный API endpoint использует `serverSupabaseServiceRole` для безопасного обхода RLS для конкретных токенов.

### Качество кода и полировка
1. **Структура Nuxt 4**: Проект использовал смесь соглашений Nuxt 3 (корневые `server`, `assets`) и Nuxt 4 (`future: { compatibilityVersion: 4 }`).
   - **Исправление**: Перемещены `server/`, `assets/`, и `shared/` в директорию `app/`. Обновлены импорты.
2. **Auth Middleware**: `auth.ts` вручную создавал Supabase клиенты.
   - **Исправление**: Рефакторинг на использование `useSupabaseUser` и `navigateTo`.
3. **Навигация**: В дефолтном layout отсутствовала навигация.
   - **Исправление**: Добавлен адаптивный Navbar со ссылками на Дашборд, Счета, Клиенты, Настройки и Выход.
4. **Страница входа**: Вручную создавался Supabase клиент.
   - **Исправление**: Рефакторинг на использование `useSupabaseClient`.
5. **Дашборд**: Отсутствовал `auth` middleware.
   - **Исправление**: Добавлен `definePageMeta({ middleware: 'auth' })`.

### Верификация
- **Сборка**: `pnpm build` проходит успешно после структурных исправлений.
- **Безопасность**: RLS политика удалена.
- **UX**: Навигация добавлена.
